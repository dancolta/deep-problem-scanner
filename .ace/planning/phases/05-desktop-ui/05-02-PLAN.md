# Plan: Scan Progress, Draft Review & Schedule Screens

**Phase:** 5 - Desktop UI
**Plan:** 2 of 2 in phase
**Status:** Ready

## Objective

Build the remaining 3 Electron screens: Scan Progress page with real-time updates, Draft Review page with email editing and approval, and Schedule Management page with queue monitoring.

## Tasks

### Task 1: Scan Progress Page
**Zone:** ALPHA
**Files:**
- `src/renderer/pages/ScanPage.tsx`
- `src/renderer/pages/ScanPage.css`

**Action:**
1. Rewrite `src/renderer/pages/ScanPage.tsx` as a full functional page:

   **Layout sections:**

   a) **Progress Header** (top):
   - Overall progress bar (completed / total)
   - Current URL being scanned
   - Stats row: Completed, Failed, Remaining counts
   - Elapsed time counter

   b) **Live Results Feed** (center, scrollable):
   - Each completed scan as a card showing:
     - Company name + URL
     - Status badge (SUCCESS green, FAILED red, BLOCKED yellow, TIMEOUT orange)
     - Diagnostics summary: 5 mini badges (pass/warning/fail)
     - Screenshot thumbnail if available (base64)
   - Auto-scroll to latest result
   - Maximum 50 visible (older ones scroll up)

   c) **Control Bar** (bottom):
   - "Cancel Scan" button → calls `SCAN_CANCEL` IPC
   - "Back to Upload" button (disabled while scanning)
   - After completion: "View Drafts" button to navigate to /drafts

   **State management:**
   - Listen to `SCAN_PROGRESS` channel via `useIpcListener` for real-time updates
   - Listen to `SCAN_COMPLETE` for final results
   - useState for: progress (ScanProgress), isScanning, elapsedTime
   - useEffect with setInterval for elapsed time counter
   - useNavigate for navigation

2. Create `src/renderer/pages/ScanPage.css`:
   - Progress bar (animated gradient fill)
   - Result cards (dark cards, status-colored left border)
   - Stats row (inline flex, monospace numbers)
   - Consistent dark theme

**Verify:**
- [ ] Real-time progress updates from SCAN_PROGRESS listener
- [ ] Progress bar reflects completion percentage
- [ ] Result cards show scan status and diagnostics
- [ ] Cancel button triggers SCAN_CANCEL
- [ ] Navigation to drafts after completion
- [ ] TypeScript compiles without errors

**Done when:**
Scan page shows real-time progress with live result feed, progress bar, and navigation to drafts on completion.

---

### Task 2: Draft Review Page
**Zone:** BETA
**Files:**
- `src/renderer/pages/DraftsPage.tsx`
- `src/renderer/pages/DraftsPage.css`

**Action:**
1. Rewrite `src/renderer/pages/DraftsPage.tsx` as a full functional page:

   **Layout sections:**

   a) **Draft List** (left panel or full width):
   - Load drafts from Google Sheet via `SHEETS_READ` IPC
   - Each draft as a card showing:
     - Company name, contact name, email
     - Subject line (editable inline)
     - Email body (editable in textarea)
     - Annotated screenshot thumbnail (from Drive URL)
     - Status badge: draft / approved / rejected
   - Filter tabs: All, Draft, Approved, Rejected

   b) **Draft Actions** (per card):
   - "Approve" button → marks as approved, updates sheet via `SHEETS_APPEND` or a status update
   - "Edit" button → toggles inline editing of subject/body
   - "Reject" button → marks as rejected
   - "Regenerate" button → placeholder (would re-call email generation)

   c) **Bulk Actions** (top bar):
   - "Approve All" button
   - "Schedule Approved" button → navigates to /schedule
   - Draft count: "Showing X of Y drafts"

   **State management:**
   - useState for: drafts array, filter, editingId, loading
   - Load drafts on mount via SHEETS_READ
   - Update individual draft status via IPC

2. Create `src/renderer/pages/DraftsPage.css`:
   - Draft card layout with screenshot thumbnail
   - Inline editing styles
   - Filter tabs
   - Action buttons (approve=green, reject=red)
   - Consistent dark theme

**Verify:**
- [ ] Drafts loaded from Sheet data
- [ ] Inline editing of subject and body
- [ ] Approve/reject status updates
- [ ] Filter tabs work
- [ ] Bulk approve all
- [ ] Navigate to schedule
- [ ] TypeScript compiles without errors

**Done when:**
Draft review page displays all generated emails, allows inline editing, approval/rejection, and bulk operations.

---

### Task 3: Schedule Management Page
**Zone:** GAMMA
**Files:**
- `src/renderer/pages/SchedulePage.tsx`
- `src/renderer/pages/SchedulePage.css`

**Action:**
1. Rewrite `src/renderer/pages/SchedulePage.tsx` as a full functional page:

   **Layout sections:**

   a) **Schedule Controls** (top):
   - "Start Sending" button → calls `SCHEDULER_START` IPC
   - "Stop Sending" button → calls `SCHEDULER_STOP` IPC
   - Status indicator: Idle / Running / Paused
   - Send interval display (from settings)
   - Next send time countdown

   b) **Email Queue** (center, scrollable table):
   - Load scheduled/approved emails from Sheet via `SHEETS_READ`
   - Table columns: #, Company, Contact, Email, Subject, Status, Scheduled Time, Sent Time
   - Status badges: pending, sending, sent, failed
   - Sort by scheduled time

   c) **Stats Panel** (right or bottom):
   - Total emails: N
   - Sent: N (green)
   - Pending: N (yellow)
   - Failed: N (red)
   - Send rate: N/hour

   d) **Activity Log** (bottom):
   - Recent send events
   - Listen to `SCHEDULER_PROGRESS` for real-time updates
   - Show timestamp + result for each send attempt

   **State management:**
   - useState for: emails array, schedulerStatus, activityLog
   - useIpcListener for SCHEDULER_PROGRESS updates
   - Load emails on mount and refresh periodically
   - useNavigate for navigation

2. Create `src/renderer/pages/SchedulePage.css`:
   - Queue table with status colors
   - Stats panel layout
   - Activity log (monospace, scrollable)
   - Control buttons
   - Consistent dark theme

**Verify:**
- [ ] Scheduler start/stop via IPC
- [ ] Email queue displays from Sheet
- [ ] Status badges and sorting
- [ ] Stats panel calculates correctly
- [ ] Activity log shows real-time updates
- [ ] TypeScript compiles without errors

**Done when:**
Schedule page controls the email sending queue, displays status, and shows real-time activity.

---

## Checkpoints

None - fully autonomous execution.

## Success Criteria

- [ ] All tasks completed
- [ ] Scan page shows real-time progress
- [ ] Drafts page allows review and editing
- [ ] Schedule page controls email sending
- [ ] TypeScript compiles without errors
- [ ] Webpack builds successfully
