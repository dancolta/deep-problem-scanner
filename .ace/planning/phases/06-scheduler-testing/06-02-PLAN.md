# Plan: End-to-End Integration & Testing

**Phase:** 6 - Email Scheduler & Integration Testing
**Plan:** 2 of 2 in phase
**Status:** Ready

## Objective

Validate the full pipeline works end-to-end: CSV upload → scan → annotate → upload screenshot → generate email → create Gmail draft → schedule sending. Fix any integration issues, add error boundaries, and ensure the app launches and runs cleanly.

## Tasks

### Task 1: Integration Smoke Test Script
**Zone:** ALPHA
**Files:**
- `scripts/smoke-test.ts`

**Action:**
1. Create `scripts/smoke-test.ts` — a Node script (not Electron) that exercises the full backend pipeline:

   **Steps:**
   a) Load `.env` via dotenv
   b) Parse a sample CSV string (3 test leads with fake data)
   c) Initialize ScannerService, scan one URL (e.g. `https://example.com`)
   d) Initialize AnnotationService, annotate the screenshot
   e) Compress the annotated image
   f) Authenticate Google OAuth (will open browser)
   g) Upload screenshot to Drive via DriveService
   h) Generate email via EmailGenerator
   i) Create Gmail draft via GmailService
   j) Append row to Sheet via SheetsService
   k) Log results at each step with pass/fail

   **Error handling:** Each step wrapped in try/catch. If a step fails, log the error and continue to next step where possible. Print final summary: X/Y steps passed.

   **Package.json script:** Add `"smoke-test": "npx ts-node scripts/smoke-test.ts"` — but just document this in comments, don't modify package.json.

**Verify:**
- [ ] Script exercises full pipeline
- [ ] Each step has clear pass/fail logging
- [ ] Graceful failure handling
- [ ] TypeScript compiles without errors

**Done when:**
Smoke test script can validate the entire backend pipeline from CSV to Gmail draft.

---

### Task 2: React Error Boundaries & Loading States
**Zone:** BETA
**Files:**
- `src/renderer/components/ErrorBoundary.tsx`
- `src/renderer/App.tsx` (modify — wrap routes in ErrorBoundary)

**Action:**
1. Create `src/renderer/components/ErrorBoundary.tsx`:
   - React class component implementing `componentDidCatch`
   - Shows fallback UI: error message + "Reload" button (calls `window.location.reload()`)
   - Dark-themed error card matching app design
   - Inline styles (no separate CSS file needed)

2. Modify `src/renderer/App.tsx`:
   - Import and wrap the route content area with `<ErrorBoundary>`
   - Ensure the sidebar stays visible even when content errors

**Verify:**
- [ ] ErrorBoundary catches rendering errors
- [ ] Fallback UI displays with reload option
- [ ] Sidebar remains functional during error state
- [ ] TypeScript compiles without errors

**Done when:**
App has error boundaries preventing white-screen crashes, with user-friendly error display.

---

### Task 3: App Polish & Final Build Validation
**Zone:** GAMMA
**Files:**
- `src/renderer/App.css` (modify — minor polish)
- `src/renderer/pages/SetupPage.tsx` (modify — add version display)
- `electron/main.ts` (modify — add unhandled rejection handler)

**Action:**
1. Modify `electron/main.ts`:
   - Add `process.on('unhandledRejection', ...)` and `process.on('uncaughtException', ...)` handlers that log errors instead of crashing
   - Add app version logging on startup: `console.log('Deep Problem Scanner v' + app.getVersion())`

2. Modify `src/renderer/pages/SetupPage.tsx`:
   - Add a small version/status line at the bottom of the page: "Deep Problem Scanner v1.0.0"

3. Modify `src/renderer/App.css`:
   - Ensure `.page` has proper overflow-y: auto for scrolling on all pages
   - Add smooth scrollbar styling for webkit (dark theme scrollbar)

**Verify:**
- [ ] Unhandled errors logged, don't crash app
- [ ] Version displayed on setup page
- [ ] Pages scroll properly with styled scrollbar
- [ ] TypeScript compiles without errors
- [ ] Webpack builds successfully
- [ ] `npx tsc -p tsconfig.main.json` passes

**Done when:**
App is polished with error handling, version display, scrolling, and passes all build checks.

---

## Checkpoints

None - fully autonomous execution.

## Success Criteria

- [ ] All tasks completed
- [ ] Smoke test script covers full pipeline
- [ ] Error boundaries prevent white-screen crashes
- [ ] App handles unhandled rejections gracefully
- [ ] TypeScript compiles without errors
- [ ] Webpack builds successfully
- [ ] App is ready for manual testing
